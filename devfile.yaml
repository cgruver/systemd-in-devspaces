schemaVersion: 2.2.0
attributes:
  controller.devfile.io/storage-type: per-workspace
metadata:
  name: systemd-in-devspaces
projects:
  - name: systemd-in-devspaces
    git:
      remotes:
        origin: https://github.com/cgruver/systemd-in-devspaces.git
      checkoutFrom:
        remote: origin
        revision: main
components:
- name: dev-tools
  attributes:
    pod-overrides:
      metadata:
        annotations:
          io.kubernetes.cri-o.Devices: "/dev/fuse,/dev/net/tun"
          io.kubernetes.cri-o.cgroup2-mount-hierarchy-rw: 'true'
      spec:
        hostUsers: false
        securityContext:
          runAsUser: 0
          fsGroup: 0
          runAsNonRoot: false
    container-overrides: 
      securityContext:
        capabilities:
          add:
            - SETGID
            - SETUID
            - CHOWN
            - SETFCAP
          drop:
            - ALL
        runAsUser: 0
        runAsNonRoot: false
        fsGroup: 0
        procMount: Unmasked
  container: 
    image: nexus.clg.lab:5002/dev-spaces/systemd-test:latest
    memoryLimit: 8Gi
    cpuLimit: "2"
    env:
    - name: HOME
      value: "/projects/home"
    - name: VSCODE_DEFAULT_WORKSPACE
      value: "/projects/systemd-in-devspaces/vscode.code-workspace"
    endpoints:
    - exposure: public
      name: podman
      protocol: https
      targetPort: 8080
